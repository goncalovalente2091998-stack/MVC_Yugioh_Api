<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartas Yu-Gi-Oh!</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Coleção de Cartas Yu-Gi-Oh!</h1>

        <!-- FILTROS -->
        <div class="row mb-4">
            <div class="col-md-4">
                <input type="text" id="filtro-nome" class="form-control" placeholder="🔍 Nome da carta">
            </div>
            <div class="col-md-4">
                <select id="filtro-tipo" class="form-control">
                    <option value="">Todos os tipos</option>
                </select>
            </div>
            <div class="col-md-4">
                <select id="filtro-arquetipo" class="form-control">
                    <option value="">Todos os arquétipos</option>
                </select>
            </div>
        </div>

        <div class="row" id="cartas-container"></div>
    </div>


    <!-- ZOOM -->
    <div id="zoom-overlay">
        <div id="zoom-card" class="text-center">
            <img src="" id="zoom-img" alt="">
            <h3 id="zoom-title" class="mt-3"></h3>
        </div>
    </div>


    <script>
        let todasCartas = [];

        async function carregarCartas() {
            const res = await fetch("https://db.ygoprodeck.com/api/v7/cardinfo.php");
            const data = await res.json();
            todasCartas = data.data;

            preencherFiltros();
            exibirCartas(todasCartas);
        }

        function preencherFiltros() {
            const tipoSelect = document.getElementById("filtro-tipo");
            const arquSelect = document.getElementById("filtro-arquetipo");

            const tipos = [...new Set(todasCartas.map(c => c.type))].sort();
            const arqs = [...new Set(todasCartas.filter(c => c.archetype).map(c => c.archetype))].sort();

            tipos.forEach(t => tipoSelect.innerHTML += `<option value="${t}">${t}</option>`);
            arqs.forEach(a => arquSelect.innerHTML += `<option value="${a}">${a}</option>`);
        }

        function exibirCartas(lista) {
            const container = document.getElementById("cartas-container");
            container.innerHTML = lista.map(c => `
                <div class="col-md-3 mb-4 d-flex justify-content-center">
                    <div class="ygocard" onclick="ampliarCarta('${c.card_images[0].image_url}', '${c.name}')">
                        <img src="${c.card_images[0].image_url}" alt="${c.name}">
                        <div class="card-body">
                            <h5 class="card-title">${c.name}</h5>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function aplicarFiltros() {
            const nome = document.getElementById("filtro-nome").value.toLowerCase();
            const tipo = document.getElementById("filtro-tipo").value;
            const arque = document.getElementById("filtro-arquetipo").value;

            const filtradas = todasCartas.filter(c =>
                c.name.toLowerCase().includes(nome) &&
                (tipo === "" || c.type === tipo) &&
                (arque === "" || c.archetype === arque)
            );

            exibirCartas(filtradas);
        }

        function ampliarCarta(img, nome) {
            document.getElementById("zoom-img").src = img;
            document.getElementById("zoom-title").innerText = nome;
            document.getElementById("zoom-overlay").style.display = "flex";
        }

        document.getElementById("zoom-overlay").onclick = function(e){
            if(e.target.id === "zoom-overlay"){
                document.getElementById("zoom-overlay").style.display = "none";
            }
        }

        document.getElementById("filtro-nome").addEventListener("input", aplicarFiltros);
        document.getElementById("filtro-tipo").addEventListener("change", aplicarFiltros);
        document.getElementById("filtro-arquetipo").addEventListener("change", aplicarFiltros);

        carregarCartas();
    </script>

</body>
</html>
